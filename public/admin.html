<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Panel - MovieBox</title>
    <style>
        body { font-family: sans-serif; background: #111; color: white; padding: 20px; }
        .form-box { background: #222; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        input, textarea, select { width: 100%; padding: 10px; margin: 10px 0; background: #333; color: white; border: 1px solid #444; }
        button { background: #e50914; color: white; padding: 10px 20px; border: none; cursor: pointer; border-radius: 5px; }
        .movie-item { background: #222; padding: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border-radius: 5px;}
        .edit-btn { background: #ffa500; margin-right: 10px; }
    </style>
</head>
<body>

    <h2>üé¨ Admin Panel</h2>

    <div class="form-box">
        <h3 id="formTitle">Add New Movie/Series</h3>
        <input type="hidden" id="movieId">
        <input type="text" id="title" placeholder="Title">
        <input type="text" id="thumb" placeholder="Thumbnail URL">
        <input type="text" id="year" placeholder="Year">
        <input type="text" id="rating" placeholder="Rating">
        <select id="category">
            <option value="movie">Movie</option>
            <option value="series">Series</option>
        </select>
        <input type="text" id="genre" placeholder="Genre (Action, Drama)">
        <textarea id="desc" placeholder="Description"></textarea>
        <input type="text" id="watchUrl" placeholder="Video Link / Watch URL">
        <button id="submitBtn" onclick="saveMovie()">Save Movie</button>
        <button id="cancelBtn" style="display:none; background:#555;" onclick="resetForm()">Cancel</button>
    </div>

    <h3>Existing Movies</h3>
    <div id="movieList"></div>

    <script>
        const ADMIN_PASS = "1122";

        // ‡¶°‡¶æ‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ
        async function loadMovies() {
            const res = await fetch('/api/series');
            const data = await res.json();
            const list = document.getElementById('movieList');
            list.innerHTML = data.map(m => `
                <div class="movie-item">
                    <span><b>${m.title}</b> (${m.category})</span>
                    <div>
                        <button class="edit-btn" onclick="editMovie('${encodeURIComponent(JSON.stringify(m))}')">Edit</button>
                        <button onclick="deleteMovie('${m._id}')">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        // ‡¶∏‡ßá‡¶≠ ‡¶¨‡¶æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
        async function saveMovie() {
            const id = document.getElementById('movieId').value;
            const data = {
                title: document.getElementById('title').value,
                thumb: document.getElementById('thumb').value,
                year: document.getElementById('year').value,
                rating: document.getElementById('rating').value,
                category: document.getElementById('category').value,
                genre: document.getElementById('genre').value,
                desc: document.getElementById('desc').value,
                watchUrl: document.getElementById('watchUrl').value
            };

            const method = id ? 'PUT' : 'POST';
            const url = id ? `/api/series/${id}` : '/api/series';

            const res = await fetch(url, {
                method: method,
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ password: ADMIN_PASS, data })
            });

            if (res.ok) {
                alert("Successfully Saved!");
                resetForm();
                loadMovies();
            } else {
                alert("Failed to save! Check console.");
            }
        }

        // ‡¶è‡¶°‡¶ø‡¶ü ‡¶Æ‡ßã‡¶° ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶ï‡¶∞‡¶æ
        function editMovie(movieStr) {
            const m = JSON.parse(decodeURIComponent(movieStr));
            document.getElementById('movieId').value = m._id;
            document.getElementById('title').value = m.title;
            document.getElementById('thumb').value = m.thumb;
            document.getElementById('year').value = m.year;
            document.getElementById('rating').value = m.rating;
            document.getElementById('category').value = m.category;
            document.getElementById('genre').value = m.genre;
            document.getElementById('desc').value = m.desc;
            document.getElementById('watchUrl').value = m.watchUrl;

            document.getElementById('formTitle').innerText = "Edit Movie";
            document.getElementById('submitBtn').innerText = "Update Movie";
            document.getElementById('cancelBtn').style.display = "inline-block";
        }

        // ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ
        async function deleteMovie(id) {
            if(!confirm("Are you sure?")) return;
            const res = await fetch(`/api/series/${id}`, {
                method: 'DELETE',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ password: ADMIN_PASS })
            });
            if (res.ok) { loadMovies(); }
        }

        function resetForm() {
            document.getElementById('movieId').value = "";
            document.getElementById('title').value = "";
            document.getElementById('formTitle').innerText = "Add New Movie/Series";
            document.getElementById('submitBtn').innerText = "Save Movie";
            document.getElementById('cancelBtn').style.display = "none";
        }

        loadMovies();
    </script>
</body>
</html>