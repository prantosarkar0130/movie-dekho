<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MovieBox - Home</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <style>
      :root {
        --primary: #00ff88;
        --bg: #0b0f15;
        --card: #161b22;
        --border: #30363d;
      }

      body {
        background: var(--bg);
        color: white;
        font-family: "Segoe UI", sans-serif;
        margin: 0;
        display: flex;
        overflow-x: hidden;
      }

      /* Sidebar Design */
      .sidebar {
        width: 260px;
        height: 100vh;
        background: #0d1117;
        border-right: 1px solid var(--border);
        position: sticky;
        top: 0;
        padding: 20px;
        box-sizing: border-box;
        transition: 0.3s;
        z-index: 1001;
      }

      .logo {
        font-size: 24px;
        font-weight: 800;
        color: var(--primary);
        margin-bottom: 40px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .nav-label {
        font-size: 12px;
        color: #8b949e;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 15px;
        display: block;
      }

      .nav-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px 15px;
        border-radius: 8px;
        cursor: pointer;
        color: #c9d1d9;
        transition: 0.3s;
        margin-bottom: 5px;
      }

      .nav-item:hover,
      .nav-item.active {
        background: rgba(0, 255, 136, 0.1);
        color: var(--primary);
      }

      .nav-item i {
        width: 20px;
      }

      /* Main Content */
      .main-content {
        flex: 1;
        padding: 30px;
        min-width: 0;
      }

      .header-box {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        gap: 15px;
      }

      .search-bar {
        background: var(--card);
        border: 1px solid var(--border);
        padding: 10px 20px;
        border-radius: 30px;
        display: flex;
        align-items: center;
        width: 400px;
        max-width: 100%;
      }

      .search-bar input {
        background: transparent;
        border: none;
        color: white;
        outline: none;
        margin-left: 10px;
        width: 100%;
      }

      .cards-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
        gap: 20px;
      }

      /* --- Updated Movie Card Design --- */
      .movie-card {
        position: relative; 
        background: var(--card);
        border-radius: 12px;
        overflow: hidden;
        border: 1px solid var(--border);
        cursor: pointer;
        transition: 0.3s;
      }

      .movie-card:hover {
        transform: translateY(-8px);
        border-color: var(--primary);
      }

      /* Blurry Language Tag (Top Right) */
      .lang-tag {
        position: absolute;
        top: 8px;
        right: 8px;
        background: rgba(0, 0, 0, 0.4);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        color: #fff;
        padding: 3px 10px;
        border-radius: 5px;
        font-size: 11px;
        font-weight: bold;
        z-index: 5;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .movie-card img {
        width: 100%;
        aspect-ratio: 2/3;
        object-fit: cover;
        display: block;
        image-rendering: -webkit-optimize-contrast;
      }

      /* Transparent Name Box (Bottom Overlay) */
      .card-body {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        padding: 35px 10px 12px 10px;
        background: linear-gradient(transparent, rgba(0, 0, 0, 0.95)); 
        box-sizing: border-box;
        z-index: 4;
      }

      .card-title {
        font-size: 14px;
        font-weight: bold;
        color: #fff;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        text-shadow: 1px 1px 3px rgba(0,0,0,0.6);
      }

      .card-meta {
        font-size: 11px;
        color: #bbb;
        margin-top: 2px;
      }

      /* Mobile Menu Button */
      .menu-btn {
        display: none;
        background: var(--card);
        border: 1px solid var(--border);
        color: white;
        padding: 10px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 20px;
      }

      /* --- RESPONSIVE QUERIES --- */
      @media (max-width: 992px) {
        .search-bar { width: 250px; }
      }

      @media (max-width: 768px) {
        body { flex-direction: column; }
        .menu-btn { display: block; }
        .sidebar { position: fixed; left: -260px; height: 100%; width: 260px; }
        .sidebar.active { left: 0; }
        .header-box { flex-wrap: wrap; }
        .main-content { padding: 20px; }
        .search-bar { order: 3; width: 100%; margin-top: 10px; }
        .overlay { display: none; position: fixed; inset: 0; background: rgba(0, 0, 0, 0.7); z-index: 1000; }
        .overlay.active { display: block; }
      }

      @media (max-width: 480px) {
        .cards-grid { grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 15px; }
      }
    </style>
  </head>

  <body>
    <div class="overlay" id="overlay" onclick="toggleMenu()"></div>

    <div class="sidebar" id="sidebar">
      <div class="logo"><i class="fas fa-play-circle"></i> MovieBox</div>

      <span class="nav-label">Menu</span>
      <div class="nav-item active" onclick="filterByCategory('All', this)">
        <i class="fas fa-home"></i> Home
      </div>
      <div class="nav-item" onclick="filterByCategory('TV Show', this)">
        <i class="fas fa-tv"></i> TV Series
      </div>
      <div class="nav-item" onclick="filterByCategory('Movie', this)">
        <i class="fas fa-film"></i> Movies
      </div>

      <span class="nav-label" style="margin-top: 30px">Categories</span>
      <div class="nav-item" onclick="filterByCategory('Action', this)">
        <i class="fas fa-fist-raised"></i> Action
      </div>
      <div class="nav-item" onclick="filterByCategory('Comedy', this)">
        <i class="fas fa-laugh"></i> Comedy
      </div>
      <div class="nav-item" onclick="filterByCategory('Horror', this)">
        <i class="fas fa-ghost"></i> Horror
      </div>
      <div class="nav-item" onclick="filterByCategory('Drama', this)">
        <i class="fas fa-theater-masks"></i> Drama
      </div>
    </div>

    <div class="main-content">
      <div class="header-box">
        <button class="menu-btn" onclick="toggleMenu()">
          <i class="fas fa-bars"></i>
        </button>
        <div class="search-bar">
          <i class="fas fa-search" style="color: #8b949e"></i>
          <input
            type="text"
            id="searchInput"
            placeholder="Search..."
            oninput="searchMovies()"
          />
        </div>
        <div
          id="categoryLabel"
          style="font-weight: bold; color: var(--primary); font-size: 14px"
        >
          All
        </div>
      </div>

      <div id="movieGrid" class="cards-grid"></div>
    </div>

    <script>
      let allMovies = [];

      function toggleMenu() {
        document.getElementById("sidebar").classList.toggle("active");
        document.getElementById("overlay").classList.toggle("active");
      }

      async function loadAllData() {
        try {
          const res = await fetch("/api/series");
          allMovies = await res.json();
          renderMovies(allMovies);
        } catch (err) {
          console.error("Data load failed");
        }
      }

      function renderMovies(data) {
        const grid = document.getElementById("movieGrid");
        grid.innerHTML = "";

        data.forEach((m) => {
          const card = document.createElement("div");
          card.className = "movie-card";
          
          let tagHTML = "";
          if (m.langTag && m.langTag.trim() !== "") {
              tagHTML = `<div class="lang-tag">${m.langTag}</div>`;
          }

          card.innerHTML = `
                ${tagHTML}
                <img src="${m.thumb}" alt="${m.title}" loading="lazy">
                <div class="card-body">
                    <div class="card-title">${m.title}</div>
                    <div class="card-meta">${m.year} • ⭐ ${m.rating || 'N/A'}</div>
                </div>
          `;
          card.onclick = () => {
            localStorage.setItem("currentMovie", JSON.stringify(m));
            // Category check kore redirect kora
            window.location.href = m.category === "TV Show" ? "series.html" : "details.html";
          };
          grid.appendChild(card);
        });
      }

      // --- Updated Category Filter Logic (Case Insensitive) ---
      function filterByCategory(cat, element) {
        document.querySelectorAll(".nav-item").forEach((el) => el.classList.remove("active"));
        element.classList.add("active");
        document.getElementById("categoryLabel").innerText = cat;
        if (window.innerWidth <= 768) toggleMenu();

        if (cat === "All") {
          renderMovies(allMovies);
        } else {
          const searchCat = cat.toLowerCase(); // Filter kora value lowercase korlam
          const filtered = allMovies.filter((m) => {
            const mCat = m.category ? m.category.toLowerCase() : "";
            const mGenre = m.genre ? m.genre.toLowerCase() : "";
            // Dono field e check hobe lowercase e
            return mCat === searchCat || mGenre.includes(searchCat);
          });
          renderMovies(filtered);
        }
      }

      function searchMovies() {
        const term = document.getElementById("searchInput").value.toLowerCase();
        const filtered = allMovies.filter((m) =>
          m.title.toLowerCase().includes(term),
        );
        renderMovies(filtered);
      }

      loadAllData();
    </script>
  </body>
</html>